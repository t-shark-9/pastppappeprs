<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Illustration Editor</title>
    <link rel="stylesheet" href="styles/main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Fabric.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1><i class="fas fa-palette"></i> Illustration Editor</h1>
                <div class="file-menu">
                    <button id="newBtn" class="btn" title="New Document (clears canvas)"><i class="fas fa-file"></i> New</button>
                    <button id="openBtn" class="btn" title="Open Project"><i class="fas fa-folder-open"></i> Open</button>
                    <button id="saveBtn" class="btn" title="Save Project"><i class="fas fa-save"></i> Save</button>
                    <button id="exportBtn" class="btn" title="Export Image"><i class="fas fa-download"></i> Export</button>
                    <button id="insertBtn" class="btn primary" title="Insert to Editor"><i class="fas fa-check"></i> Insert to Editor</button>
                </div>
            </div>
            <div class="header-right">
                <button id="undoBtn" class="btn" title="Undo (Ctrl+Z)"><i class="fas fa-undo"></i></button>
                <button id="redoBtn" class="btn" title="Redo (Ctrl+Y)"><i class="fas fa-redo"></i></button>
            </div>
        </header>

        <!-- Horizontal Toolbar -->
        <div class="horizontal-toolbar">
            <!-- Top Row: Tools and Properties -->
            <div class="toolbar-row">
                <!-- Tools Section with Dropdowns -->
                <div class="tools-section">
                    <button class="tool-btn active" data-tool="select" title="Select (V)"><i class="fas fa-mouse-pointer"></i></button>
                    
                    <!-- Pen Tools Dropdown -->
                    <div class="dropdown-wrapper">
                        <button class="tool-btn dropdown-toggle" title="Drawing Tools">
                            <i class="fas fa-pen"></i>
                            <i class="fas fa-caret-down dropdown-arrow"></i>
                        </button>
                        <div class="dropdown-menu">
                            <button class="dropdown-item" data-tool="pen"><i class="fas fa-pen"></i> Pen (P)</button>
                            <button class="dropdown-item" data-tool="brush"><i class="fas fa-paint-brush"></i> Brush (B)</button>
                            <button class="dropdown-item" data-tool="highlighter"><i class="fas fa-highlighter"></i> Highlighter (H)</button>
                            <button class="dropdown-item" data-tool="eraser"><i class="fas fa-eraser"></i> Eraser (E)</button>
                        </div>
                    </div>
                    
                    <!-- Shape Tools Dropdown -->
                    <div class="dropdown-wrapper">
                        <button class="tool-btn dropdown-toggle" title="Shape Tools">
                            <i class="far fa-square"></i>
                            <i class="fas fa-caret-down dropdown-arrow"></i>
                        </button>
                        <div class="dropdown-menu">
                            <button class="dropdown-item" data-tool="line"><i class="fas fa-minus"></i> Line (L)</button>
                            <button class="dropdown-item" data-tool="arrow"><i class="fas fa-arrow-right"></i> Arrow (A)</button>
                            <button class="dropdown-item" data-tool="rectangle"><i class="far fa-square"></i> Rectangle (R)</button>
                            <button class="dropdown-item" data-tool="circle"><i class="far fa-circle"></i> Circle (O)</button>
                            <button class="dropdown-item" data-tool="ellipse"><i class="fas fa-circle" style="transform: scaleY(0.6);"></i> Ellipse</button>
                            <button class="dropdown-item" data-tool="triangle"><i class="fas fa-play" style="transform: rotate(-90deg);"></i> Triangle</button>
                            <button class="dropdown-item" data-tool="polygon"><i class="fas fa-draw-polygon"></i> Polygon (click points, Esc to finish)</button>
                        </div>
                    </div>
                    
                    <button class="tool-btn" data-tool="text" title="Text (T)"><i class="fas fa-font"></i></button>
                </div>

                <div class="toolbar-divider"></div>

                <!-- Stroke Style -->
                <div class="property-group">
                    <label>Style:</label>
                    <select id="strokeStyle" class="property-select" title="Line Style">
                        <option value="solid">━━━ Solid</option>
                        <option value="dashed">╌╌╌ Dashed</option>
                        <option value="dotted">····· Dotted</option>
                        <option value="dash-dot">╌·╌ Dash-Dot</option>
                    </select>
                </div>

                <!-- Color Stack (Stroke + Fill) -->
                <div class="v-stack">
                    <div class="property-row">
                        <label>Stroke:</label>
                        <input type="color" id="strokeColor" value="#000000" title="Stroke Color">
                    </div>
                    <div class="property-row">
                        <label>Fill:</label>
                        <input type="color" id="fillColor" value="#ffffff" title="Fill Color">
                        <label class="checkbox-label">
                            <input type="checkbox" id="fillEnabled" title="Enable Fill">
                            <span>On</span>
                        </label>
                    </div>
                </div>

                <!-- Slider Stack (Width + Opacity) -->
                <div class="v-stack">
                    <div class="property-row">
                        <label>Width:</label>
                        <input type="range" id="strokeWidth" min="1" max="50" value="2" title="Stroke Width">
                        <span id="widthDisplay">2px</span>
                    </div>
                    <div class="property-row">
                        <label>Opacity:</label>
                        <input type="range" id="opacity" min="0" max="1" step="0.1" value="1" title="Opacity">
                        <span id="opacityDisplay">100%</span>
                    </div>
                </div>
                
                <div class="toolbar-divider"></div>
                
                <!-- Highlighter Color -->
                <div class="property-group highlighter-group">
                    <label><i class="fas fa-highlighter"></i></label>
                    <input type="color" id="highlighterColor" value="#ffff00" title="Highlighter Color">
                </div>
            </div>

            <!-- Bottom Row: Layers, Transform, and Image -->
            <div class="toolbar-row-bottom">
                <!-- Layers Section -->
                <div class="inline-section">
                    <label>Layers:</label>
                    <button id="addLayerBtn" class="btn small" title="Add Layer"><i class="fas fa-plus"></i></button>
                    <button id="deleteLayerBtn" class="btn small" title="Delete Layer"><i class="fas fa-trash"></i></button>
                    <button id="duplicateLayerBtn" class="btn small" title="Duplicate Layer"><i class="fas fa-copy"></i></button>
                    <div id="layersList" class="layers-list-inline">
                        <!-- Layers will be populated here -->
                    </div>
                </div>
                
                <div class="toolbar-divider"></div>
                
                <!-- Transform Section -->
                <div class="inline-section">
                    <label>Transform:</label>
                    <button id="flipHorizontalBtn" class="btn small" title="Flip Horizontal"><i class="fas fa-arrows-alt-h"></i></button>
                    <button id="flipVerticalBtn" class="btn small" title="Flip Vertical"><i class="fas fa-arrows-alt-v"></i></button>
                    <button id="rotateCCWBtn" class="btn small" title="Rotate -90°"><i class="fas fa-undo"></i></button>
                    <button id="rotateCWBtn" class="btn small" title="Rotate +90°"><i class="fas fa-redo"></i></button>
                </div>
                
                <div class="toolbar-divider"></div>

                <!-- Image Section -->
                <div class="inline-section">
                    <label>Image:</label>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                    <button class="btn small" onclick="document.getElementById('imageUpload').click()" title="Upload Image">
                        <i class="fas fa-image"></i> Upload
                    </button>
                </div>
                
                <div class="toolbar-divider"></div>
                
                <!-- Canvas Actions -->
                <div class="inline-section">
                    <button id="clearCanvasBtn" class="btn small danger" title="Clear Canvas"><i class="fas fa-trash-alt"></i> Clear All</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Canvas Area -->
            <div class="canvas-container">
                <div class="canvas-wrapper">
                    <canvas id="mainCanvas"></canvas>
                    <canvas id="overlayCanvas"></canvas>
                </div>
                <div class="canvas-controls">
                    <button id="zoomOutBtn" class="btn small" title="Zoom Out"><i class="fas fa-minus"></i></button>
                    <span id="zoomLevel">100%</span>
                    <button id="zoomInBtn" class="btn small" title="Zoom In"><i class="fas fa-plus"></i></button>
                    <button id="zoomResetBtn" class="btn small" title="Reset Zoom">100%</button>
                    <button id="zoomFitBtn" class="btn small" title="Fit to Screen">Fit</button>
                </div>
            </div>
        </div>
        
        <!-- Keyboard Shortcuts Help -->
        <div class="shortcuts-panel" id="shortcutsPanel">
            <button class="shortcuts-toggle" id="shortcutsToggle" title="Keyboard Shortcuts">
                <i class="fas fa-keyboard"></i>
            </button>
            <div class="shortcuts-content" id="shortcutsContent" style="display: none;">
                <h4>Keyboard Shortcuts</h4>
                <div class="shortcuts-list">
                    <div><kbd>V</kbd> Select</div>
                    <div><kbd>P</kbd> Pen</div>
                    <div><kbd>B</kbd> Brush</div>
                    <div><kbd>H</kbd> Highlighter</div>
                    <div><kbd>E</kbd> Eraser</div>
                    <div><kbd>L</kbd> Line</div>
                    <div><kbd>A</kbd> Arrow</div>
                    <div><kbd>R</kbd> Rectangle</div>
                    <div><kbd>O</kbd> Circle</div>
                    <div><kbd>T</kbd> Text</div>
                    <div><kbd>[ ]</kbd> Brush Size</div>
                    <div><kbd>Del</kbd> Delete</div>
                    <div><kbd>Ctrl+Z</kbd> Undo</div>
                    <div><kbd>Ctrl+Y</kbd> Redo</div>
                    <div><kbd>Ctrl+C</kbd> Copy</div>
                    <div><kbd>Ctrl+V</kbd> Paste</div>
                    <div><kbd>Ctrl+D</kbd> Duplicate</div>
                    <div><kbd>Ctrl+A</kbd> Select All</div>
                    <div><kbd>Ctrl+G</kbd> Group</div>
                    <div><kbd>Ctrl+Shift+G</kbd> Ungroup</div>
                    <div><kbd>↑↓←→</kbd> Nudge</div>
                    <div><kbd>Esc</kbd> Cancel</div>
                </div>
            </div>
        </div>
        
        <!-- Tips Panel -->
        <div class="tips-panel">
            <div class="tip">
                <i class="fas fa-lightbulb"></i>
                <span>Tip: Right-click on selected objects for more options including line style changes!</span>
            </div>
        </div>
    </div>

    <!-- Modal for text input -->
    <div id="textModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="fas fa-font"></i> Add Text</h2>
            <textarea id="textInput" placeholder="Enter text..." rows="4"></textarea>
            <div class="text-options">
                <select id="fontFamily">
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Courier New">Courier New</option>
                    <option value="Comic Sans MS">Comic Sans MS</option>
                </select>
                <input type="number" id="fontSize" value="24" min="8" max="200" title="Font Size">
                <button id="boldBtn" class="btn small" title="Bold"><i class="fas fa-bold"></i></button>
                <button id="italicBtn" class="btn small" title="Italic"><i class="fas fa-italic"></i></button>
            </div>
            <div class="modal-actions">
                <button id="cancelTextBtn" class="btn">Cancel</button>
                <button id="addTextBtn" class="btn primary">Add Text</button>
            </div>
        </div>
    </div>
    
    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="fas fa-download"></i> Export Image</h2>
            <div class="export-options">
                <div class="export-format">
                    <label>Format:</label>
                    <select id="exportFormat">
                        <option value="png">PNG (Transparent background supported)</option>
                        <option value="jpeg">JPEG (Smaller file size)</option>
                    </select>
                </div>
                <div class="export-quality" id="jpegQualityGroup" style="display: none;">
                    <label>Quality:</label>
                    <input type="range" id="exportQuality" min="0.1" max="1" step="0.1" value="0.9">
                    <span id="qualityDisplay">90%</span>
                </div>
            </div>
            <div class="modal-actions">
                <button id="cancelExportBtn" class="btn">Cancel</button>
                <button id="confirmExportBtn" class="btn primary">Export</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/history.js"></script>
    <script src="js/canvas.js"></script>
    <script src="js/tools.js"></script>
    <script src="js/layers.js"></script>
    <script src="js/imageEditor.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Shortcuts panel toggle
        document.getElementById('shortcutsToggle').addEventListener('click', () => {
            const content = document.getElementById('shortcutsContent');
            content.style.display = content.style.display === 'none' ? 'block' : 'none';
        });
        
        // Export modal handling
        document.getElementById('exportFormat')?.addEventListener('change', (e) => {
            const jpegGroup = document.getElementById('jpegQualityGroup');
            jpegGroup.style.display = e.target.value === 'jpeg' ? 'flex' : 'none';
        });
        
        document.getElementById('exportQuality')?.addEventListener('input', (e) => {
            document.getElementById('qualityDisplay').textContent = Math.round(e.target.value * 100) + '%';
        });
        
        document.getElementById('confirmExportBtn')?.addEventListener('click', () => {
            const format = document.getElementById('exportFormat').value;
            const quality = parseFloat(document.getElementById('exportQuality').value);
            window.canvasManager.exportCanvas(format, quality);
            document.getElementById('exportModal').style.display = 'none';
        });
        
        document.getElementById('cancelExportBtn')?.addEventListener('click', () => {
            document.getElementById('exportModal').style.display = 'none';
        });
        
        // Close export modal on close button
        document.querySelectorAll('#exportModal .close').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('exportModal').style.display = 'none';
            });
        });
        
        // Hide tips after 10 seconds
        setTimeout(() => {
            const tip = document.querySelector('.tips-panel');
            if (tip) tip.style.opacity = '0';
            setTimeout(() => tip?.remove(), 500);
        }, 10000);
    </script>
</body>
</html>
